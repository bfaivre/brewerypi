{% extends "base.html" %}
{% set namespace = namespace(numberOfDefaultColumnsForEventFrames = 15) %}
{% block title %}Event Frames{% endblock %}
{% block page_content %}
    <div>
        <ol class = "breadcrumb">
            {% if childrenClass == "Enterprise" %}
                <li class = "active"><span class = "glyphicon glyphicon-home"></span></li>
                {% set pageHeaderSubText = "Enterprises" %}
            {% elif childrenClass == "Site" %}
                <li><a href = '{{ url_for("eventFrames.selectEventFrame", selectedClass = "Root") }}'><span class = "glyphicon glyphicon-home"></span></a></li>
                <li class = "active">
                    <a title = "Previous" href = '{{ url_for("eventFrames.selectEventFrame", selectedClass = "Enterprise",
                        selectedId = parent.previous().id()) }}'><span class = "glyphicon glyphicon-arrow-left"></span></a>
                    <a title = "Next" href = '{{ url_for("eventFrames.selectEventFrame", selectedClass = "Enterprise",
                        selectedId = parent.next().id()) }}'><span class = "glyphicon glyphicon-arrow-right"></span></a>    
                    {{ parent.Name }}
                </li>
                {% set pageHeaderSubText = "Sites" %}
            <!-- "and parent" checks for systems that have not been configured with a site yet. -->
            {% elif childrenClass == "ElementTemplate" and parent %}
                <li><a href = '{{ url_for("eventFrames.selectEventFrame", selectedClass = "Root") }}'><span class = "glyphicon glyphicon-home"></span></a></li>
                <li><a href = '{{ url_for("eventFrames.selectEventFrame", selectedClass = "Enterprise",
                    selectedId = parent.Enterprise.id()) }}'>{{ parent.Enterprise.Name }}</a></li>
                <li class = "active">
                    <a title = "Previous" href = '{{ url_for("eventFrames.selectEventFrame", selectedClass = "Site", selectedId = parent.previous().id()) }}'>
                        <span class = "glyphicon glyphicon-arrow-left"></span></a>
                    <a title = "Next" href = '{{ url_for("eventFrames.selectEventFrame", selectedClass = "Site", selectedId = parent.next().id()) }}'>
                        <span class = "glyphicon glyphicon-arrow-right"></span></a>    
                    {{ parent.Name }}
                </li>
                {% set pageHeaderSubText = "Element Templates" %}
            {% elif childrenClass == "EventFrameTemplate" %}
                <li><a href = '{{ url_for("eventFrames.selectEventFrame", selectedClass = "Root") }}'><span class = "glyphicon glyphicon-home"></span></a></li>
                <li><a href = '{{ url_for("eventFrames.selectEventFrame", selectedClass = "Enterprise",
                    selectedId = parent.Site.Enterprise.id()) }}'>{{ parent.Site.Enterprise.Name }}</a></li>
                <li><a href = '{{ url_for("eventFrames.selectEventFrame", selectedClass = "Site",
                    selectedId = parent.Site.id()) }}'>{{ parent.Site.Name }}</a></li>
                <li class = "active">
                    <a title = "Previous" href = '{{ url_for("eventFrames.selectEventFrame", selectedClass = "ElementTemplate",
                        selectedId = parent.previous().id()) }}'><span class = "glyphicon glyphicon-arrow-left"></span></a>
                    <a title = "Next" href = '{{ url_for("eventFrames.selectEventFrame", selectedClass = "ElementTemplate",
                        selectedId = parent.next().id()) }}'><span class = "glyphicon glyphicon-arrow-right"></span></a>    
                    {{ parent.Name }}
                </li>
                {% set pageHeaderSubText = "Event Frame Templates" %}
            {% elif childrenClass == "EventFrame" %}
                <li><a href = '{{ url_for("eventFrames.selectEventFrame", selectedClass = "Root") }}'><span class = "glyphicon glyphicon-home"></span></a></li>
                <li><a href = '{{ url_for("eventFrames.selectEventFrame", selectedClass = "Enterprise",
                    selectedId = parent.ElementTemplate.Site.Enterprise.id()) }}'>{{ parent.ElementTemplate.Site.Enterprise.Name }}</a></li>
                <li><a href = '{{ url_for("eventFrames.selectEventFrame", selectedClass = "Site",
                    selectedId = parent.ElementTemplate.Site.id()) }}'>{{ parent.ElementTemplate.Site.Name }}</a></li>
                <li><a href = '{{ url_for("eventFrames.selectEventFrame", selectedClass = "ElementTemplate",
                    selectedId = parent.ElementTemplate.id()) }}'>{{ parent.ElementTemplate.Name }}</a></li>
                <li class = "active">
                    <a title = "Previous" href = '{{ url_for("eventFrames.selectEventFrame", selectedClass = "EventFrameTemplate",
                        selectedId = parent.previous().id()) }}'><span class = "glyphicon glyphicon-arrow-left"></span></a>
                    <a title = "Next" href = '{{ url_for("eventFrames.selectEventFrame", selectedClass = "EventFrameTemplate",
                        selectedId = parent.next().id()) }}'><span class = "glyphicon glyphicon-arrow-right"></span></a>    
                    {{ parent.Name }}
                </li>
                {% set pageHeaderSubText = "" %}
            {% elif childrenClass == "DescendantEventFrameTemplate" %}
                {% set origin = parent.origin() %}
                <li><a href = '{{ url_for("eventFrames.selectEventFrame", selectedClass = "Root") }}'><span class = "glyphicon glyphicon-home"></span></a></li>
                <li><a href = '{{ url_for("eventFrames.selectEventFrame", selectedClass = "Enterprise",
                    selectedId = origin.ElementTemplate.Site.Enterprise.id()) }}'>{{ origin.ElementTemplate.Site.Enterprise.Name }}</a></li>
                <li><a href = '{{ url_for("eventFrames.selectEventFrame", selectedClass = "Site",
                    selectedId = origin.ElementTemplate.Site.id()) }}'>{{ origin.ElementTemplate.Site.Name }}</a></li>
                <li><a href = '{{ url_for("eventFrames.selectEventFrame", selectedClass = "ElementTemplate",
                    selectedId = origin.ElementTemplate.id()) }}'>{{ origin.ElementTemplate.Name }}</a></li>
                {% for ancestor in parent.ancestors([]) %}
                    <li><a href = '{{ url_for("eventFrames.selectEventFrame", selectedClass = "EventFrameTemplate", selectedId = ancestor.id(),
                        selectedOperation = "configure") }}'>{{ ancestor.Name }}</a></li>
                {% endfor %}
                <li class = "active">
                    <a title = "Previous" href = '{{ url_for("eventFrames.selectEventFrame", selectedClass = "EventFrameTemplate",
                        selectedId = parent.previous().id(), selectedOperation = "configure") }}'><span class = "glyphicon glyphicon-arrow-left"></span></a>
                    <a title = "Next" href = '{{ url_for("eventFrames.selectEventFrame", selectedClass = "EventFrameTemplate",
                        selectedId = parent.next().id(), selectedOperation = "configure") }}'><span class = "glyphicon glyphicon-arrow-right"></span></a>    
                    {{ parent.Name }}
                </li>
                {% set pageHeaderSubText = "Child Event Frame Templates" %}
            {% endif %}
        </ol>
    </div>
    <div class = "page-header">
        <h1>Event Frames <small>{{ pageHeaderSubText }}</small>
            {% if childrenClass == "EventFrame" %}
                <a class = 'btn btn-primary btn-xs {{ "active" if months is none }}' title = "Active" href = '{{ url_for("eventFrames.selectEventFrame",
                    selectedClass = "EventFrameTemplate", selectedId = parent.id(), months = none) }}' role = "button">Active</a>
                <a class = 'btn btn-primary btn-xs {{ "active" if months == 1 }}' title = "1 Mo" href = '{{ url_for("eventFrames.selectEventFrame",
                    selectedClass = "EventFrameTemplate", selectedId = parent.id(), months = 1) }}' role = "button">1 Mo</a>
                <a class = 'btn btn-primary btn-xs {{ "active" if months == 2 }}' title = "2 Mo" href = '{{ url_for("eventFrames.selectEventFrame",
                    selectedClass = "EventFrameTemplate", selectedId = parent.id(), months = 2) }}' role = "button">2 Mo</a>
                <a class = 'btn btn-primary btn-xs {{ "active" if months == 3 }}' title = "3 Mo" href = '{{ url_for("eventFrames.selectEventFrame",
                    selectedClass = "EventFrameTemplate", selectedId = parent.id(), months = 3) }}' role = "button">3 Mo</a>
                <a class = 'btn btn-primary btn-xs {{ "active" if months == 6 }}' title = "6 Mo" href = '{{ url_for("eventFrames.selectEventFrame",
                    selectedClass = "EventFrameTemplate", selectedId = parent.id(), months = 6) }}' role = "button">6 Mo</a>
                <a class = 'btn btn-primary btn-xs {{ "active" if months == 9 }}' title = "9 Mo" href = '{{ url_for("eventFrames.selectEventFrame",
                    selectedClass = "EventFrameTemplate", selectedId = parent.id(), months = 9) }}' role = "button">9 Mo</a>
                <a class = 'btn btn-primary btn-xs {{ "active" if months == 12 }}' title = "1 Yr" href = '{{ url_for("eventFrames.selectEventFrame",
                    selectedClass = "EventFrameTemplate", selectedId = parent.id(), months = 12) }}' role = "button">1 Yr</a>
                <a class = 'btn btn-primary btn-xs {{ "active" if months == 0 }}' title = "All" href = '{{ url_for("eventFrames.selectEventFrame",
                    selectedClass = "EventFrameTemplate", selectedId = parent.id(), months = 0) }}' role = "button">All</a>
            {% endif %}
        </h1>
    </div>
    <div>
        {% if childrenClass == "ElementTemplate" %}
            <a class = "btn btn-default" title = "Dash" href = '{{ url_for("dashes.eventFramesSummary", siteId = parent.SiteId) }}'>
                <span class = "glyphicon glyphicon-stats"></span></a>
            <br><br>
        {% elif childrenClass == "EventFrameTemplate" %}
            {% if current_user.isAdministrator() %}
                <a class = "btn btn-default" title = "Add" href = '{{ url_for("eventFrameTemplates.addEventFrameTemplate", elementTemplateId = parent.id()) }}'
                    role = "button"><span class = "glyphicon glyphicon-plus"></span></a>
            {% endif %}
            <a class = "btn btn-default" title = "Dash" href = '{{ url_for("dashes.eventFramesSummary", elementTemplateId = parent.ElementTemplateId) }}'>
                <span class = "glyphicon glyphicon-stats"></span></a>
            <br><br>
        {% elif childrenClass == "EventFrame" %}
            <a class = "btn btn-default" title = "Add" href = '{{ url_for("eventFrames.addEventFrame", eventFrameTemplateId = parent.id()) }}' role = "button">
                <span class = "glyphicon glyphicon-plus"></span></a>
            <a class = "btn btn-default" title = "Dash" href = '{{ url_for("dashes.eventFramesSummary",
                eventFrameTemplateId = parent.EventFrameTemplateId, months = months) }}'><span class = "glyphicon glyphicon-stats"></span></a>
            <br><br>
        {% elif childrenClass == "DescendantEventFrameTemplate" %}
            <a class = "btn btn-default" title = "Add" href = '{{ url_for("eventFrameTemplates.addEventFrameTemplate",
                parentEventFrameTemplateId = parent.id()) }}' role = "button"><span class = "glyphicon glyphicon-plus"></span></a>
            <br><br>
        {% endif %}
    </div>
    {% if childrenClass == "EventFrame" %}
        <div>
            Toggle Column:
            <button type = "button" class = "btn btn-primary btn-xs" id = "buttonHideAllColumns">Hide All</button>
            {% for eventFrameAttributeTemplate in eventFrameAttributeTemplates %}
                {% set dataColumnIndex = loop.index0 + namespace.numberOfDefaultColumnsForEventFrames %}
                <label><button type = "button" class = "btn btn-primary btn-xs" data-columnIndex = "{{ dataColumnIndex }}"
                    id = "buttonToggleColumn{{ eventFrameAttributeTemplate.Name }}">{{ eventFrameAttributeTemplate.Name }}</button></label>
            {% endfor %}
            <button type = "button" class = "btn btn-primary btn-xs" id = "buttonShowAllColumns">Show All</button>
            <br><br>    
        </div>
        <div id = "divLoading" class = "text-center">
            <img src = '{{ url_for("static", filename = "images/loading.gif") }}'>
        </div>
    {% endif %}
    <div>
        <table id = "table" class = "table table-hover" style = "display:none">
            <thead>
                <tr>
                    <th></th>
                    <th></th>
                    {% if childrenClass == "EventFrame" %}
                        <th></th>
                    {% endif %}
                    <th>Name</th>
                    {% if childrenClass == "Enterprise" or childrenClass == "Site" or childrenClass == "ElementTemplate" %}
                        <th>Description</th>
                    {% elif childrenClass == "EventFrameTemplate" %}
                        <th>Description</th>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                    {% elif childrenClass == "EventFrame" %}
                        <th>Element</th>
                        <th>Source Event Frame</th>
                        <th>User</th>
                        <th id = "thStartTimestamp">Start Timestamp</th>
                        <th id = "thEndTimestamp">End Timestamp</th>
                        <th id = "thDurationSeconds"></th>
                        <th id = "thDuration">Duration</th>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                        {% for eventFrameAttributeTemplate in eventFrameAttributeTemplates %}
                            <th>{{ eventFrameAttributeTemplate.Name }}</th>
                        {% endfor %}
                    {% elif childrenClass == "DescendantEventFrameTemplate" %}
                        <th>Description</th>
                        <th>Order</th>
                        <th></th>
                        <th></th>
                        <th></th>
                    {% endif %}
                </tr>
            </thead>
            <tbody>
                {% if children %}
                    {% for child in children %}
                        {% if child.EventFrameId is defined %}
                            <tr id = "trEventFrame{{ child.EventFrameId }}">
                        {% else %}
                            <tr>
                        {% endif %}
                            {% if childrenClass == "EventFrame" %}
                                <td><a class = "btn btn-default" title = "Select" href = '{{ url_for("eventFrames.dashboard",
                                    eventFrameId = child.EventFrameId) }}'><span class = "glyphicon glyphicon-list"></span></a></td>
                                <td><a class = "btn btn-default" title = "Dash"
                                    href = '{{ url_for("dashes.eventFrameGraph", eventFrameId = child.EventFrameId) }}'>
                                    <span class = "glyphicon glyphicon-stats"></span></a></td>
                                <td><a class = "btn btn-default" title = "Send Message"
                                    href = '{{ url_for("messages.addMessage", eventFrameId = child.EventFrameId) }}'>
                                    <span class = "glyphicon glyphicon-envelope"></span></a></td>
                            {% elif childrenClass == "DescendantEventFrameTemplate" %}
                                <td><a class = "btn btn-default" title = "Select" href = '{{ url_for("eventFrames.selectEventFrame",
                                    selectedClass = child.__class__.__name__, selectedId = child.id(),
                                    selectedOperation = "configure") }}'><span class = "glyphicon glyphicon-list"></span></a></td>
                                <td></td>
                            {% else %}
                                <td><a class = "btn btn-default" title = "Select" href = '{{ url_for("eventFrames.selectEventFrame",
                                    selectedClass = child.__class__.__name__, selectedId = child.id()) }}'><span class = "glyphicon glyphicon-list"></span>
                                    </a></td>
                                <td></td>
                            {% endif %}
                            {% if childrenClass == "Enterprise" or childrenClass == "Site" or childrenClass == "ElementTemplate" %}
                                <td>{{ child.Name }}</td>
                                <td>{{ child.Description }}</td>
                            {% elif childrenClass == "EventFrameTemplate" %}
                                <td>{{ child.Name }}</td>
                                <td>{{ child.Description }}</td>
                                {% if current_user.isAdministrator() %}
                                    <td><a class = "btn btn-default" title = "Configure" href = '{{ url_for("eventFrames.selectEventFrame",
                                        selectedClass = "EventFrameTemplate", selectedId = child.id(), selectedOperation = "configure") }}'>
                                        <span class = "glyphicon glyphicon-wrench"></span></a></td>
                                    <td><a class = "btn btn-default" title = "Copy" href = '{{ url_for("eventFrameTemplates.copy",
                                        fromEventFrameTemplateId = child.id()) }}'><span class = "glyphicon glyphicon-copy"></span></a></td>
                                {% else %}
                                    <td></td>
                                    <td></td>
                                {% endif %}
                                {% if current_user.isAdministrator() %}
                                    <td><a class = "btn btn-default" title = "Edit" href = '{{ url_for("eventFrameTemplates.editEventFrameTemplate",
                                        eventFrameTemplateId = child.id()) }}'><span class = "glyphicon glyphicon-edit"></span></a></td>
                                    <td><a class = "btn btn-default" title = "Delete" href = '{{ url_for("eventFrameTemplates.deleteEventFrameTemplate",
                                        eventFrameTemplateId = child.id()) }}', data-type = "event frame template", data-name = "{{ child.Name }}">
                                        <span class = "glyphicon glyphicon-trash"></span></a></td>
                                {% else %}
                                    <td></td>
                                    <td></td>
                                {% endif %}
                            {% elif childrenClass == "EventFrame" %}
                                <td>{{ child.Name }}<a href = '{{ url_for("messages.listMessages") }}'>
                                    <span id = "spanEventFrameMessages{{ child.EventFrameId }}" class = "badge" style = "visibility: hidden"></span></a></td>
                                <td>{{ child.ElementName }}</td>
                                {% if child.SourceEventFrameName == None %}
                                    <td></td>
                                {% else %}
                                    <td>{{ child.SourceEventFrameName }}</td>
                                {% endif %}
                                <td>{{ child.UserName }}</td>
                                <td>{{ moment(child.StartTimestamp).format("YYYY-MM-DD HH:mm:ss") }}</td>
                                {% if child.EndTimestamp %}
                                    <td>{{ moment(child.EndTimestamp).format("YYYY-MM-DD HH:mm:ss") }}</td>
                                {% else %}
                                    <td></td>
                                {% endif %}
                                <td>{{ child.DurationSeconds }}</td>
                                {% if child.DurationSeconds < 60 %}
                                    <td>{{ child.DurationSeconds }} sec</td>
                                {% elif child.DurationSeconds < 3600 %}
                                    <td>{{ (child.DurationSeconds / 60) | round(1) }} mins</td>
                                {% elif child.DurationSeconds < 86400 %}
                                    <td>{{ (child.DurationSeconds / 3600) | round(1) }} hrs</td>
                                {% else %}
                                    <td>{{ (child.DurationSeconds / 86400) | round(1) }} days</td>
                                {% endif %}
                                {% if current_user.isAdministrator() and child.ElementTagAreaId is none %}
                                    <td><a class = "btn btn-default" title = "Associate Attributes with Tags"
                                        href = '{{ url_for("eventFrameAttributes.listEventFrameAttributes", eventFrameId = child.EventFrameId) }}'>
                                        <span class = "glyphicon glyphicon-link"></span></a></td>
                                {% else %}
                                    <td></td>
                                {% endif %}
                                {% if child.EndTimestamp is none %}
                                    <td><a class = "btn btn-default" title = "End" href = '{{ url_for("eventFrames.endEventFrame",
                                        eventFrameId = child.EventFrameId) }}'><span class = "glyphicon glyphicon-stop"></span></a></td>
                                {% else %}
                                    <td></td>
                                {% endif %}
                                <td><a class = "btn btn-default" title = "Edit"
                                    href = '{{ url_for("eventFrames.editEventFrame", eventFrameId = child.EventFrameId) }}'>
                                    <span class = "glyphicon glyphicon-edit"></span></a></td>
                                <td><a class = "btn btn-default" title = "Delete"
                                    href = '{{ url_for("eventFrames.deleteEventFrame", eventFrameId = child.EventFrameId) }}', data-type = "event frame",
                                    data-name = "{{ child.Name }}"><span class = "glyphicon glyphicon-trash"></span></a></td>
                                {% for eventFrameAttributeTemplate in eventFrameAttributeTemplates %}
                                    <td>{{ child[eventFrameAttributeTemplate.Name] }}</td>
                                {% endfor %}
                            {% elif childrenClass == "DescendantEventFrameTemplate" %}
                                <td>{{ child.Name }}</td>
                                <td>{{ child.Description }}</td>
                                <td>{{ child.Order }}</td>
                                <td><a class = "btn btn-default" title = "Edit" href = '{{ url_for("eventFrameTemplates.editEventFrameTemplate",
                                    eventFrameTemplateId = child.id()) }}'><span class = "glyphicon glyphicon-edit"></span></a></td>
                                <td><a class = "btn btn-default" title = "Delete" href = '{{ url_for("eventFrameTemplates.deleteEventFrameTemplate",
                                    eventFrameTemplateId = child.id()) }}', data-type = "child event frame template", data-name = "{{ child.Name }}">
                                    <span class = "glyphicon glyphicon-trash"></span></a></td>
                            {% endif %}
                        </tr>
                    {% endfor %}
                {% endif %}
            </tbody>
        </table>
    </div>
    {% if childrenClass == "DescendantEventFrameTemplate" %}
        <div class = "page-header">
            <h1>Event Frames <small>Attribute Templates</small></h1>
        </div>
        <div>
            <a class = "btn btn-default" title = "Add Event Frame Attribute Template"
                href = '{{ url_for("eventFrameAttributeTemplates.addEventFrameAttributeTemplate",
                eventFrameTemplateId = parent.EventFrameTemplateId) }}' role = "button"><span class = "glyphicon glyphicon-plus"></span></a>
            <a class = "btn btn-default" title = "Add Event Frame Attribute Lookup Template"
                href = '{{ url_for("eventFrameAttributeTemplates.addEventFrameAttributeTemplate",
                eventFrameTemplateId = parent.EventFrameTemplateId, lookup = True) }}' role = "button"><span class = "glyphicon glyphicon-plus">
                </span> Lookup</a>
            <br><br>
            <table id = "eventFrameAttributeTemplatesTable" class = "table table-hover" style = "display:none">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Description</th>
                        <th>Lookup</th>
                        <th>Unit</th>
                        <th>Default Start</th>
                        <th>Default End</th>
                        <th></th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    {% for eventFrameAttributeTemplate in eventFrameAttributeTemplates %}
                    <tr>
                        <td>{{ eventFrameAttributeTemplate.Name }}</td>
                        <td>{{ eventFrameAttributeTemplate.Description }}</td>
                        <td>{{ "" if eventFrameAttributeTemplate.LookupId is none else eventFrameAttributeTemplate.Lookup.Name }}</td>
                        <td>{{ "" if eventFrameAttributeTemplate.UnitOfMeasurementId is none else eventFrameAttributeTemplate.UnitOfMeasurement.Abbreviation }}
                            </td>
                        {% if eventFrameAttributeTemplate.Lookup is none %}
                            <td>{{ "" if eventFrameAttributeTemplate.DefaultStartValue is none else eventFrameAttributeTemplate.DefaultStartValue }}</td>
                            <td>{{ "" if eventFrameAttributeTemplate.DefaultEndValue is none else eventFrameAttributeTemplate.DefaultEndValue}}</td>
                        {% else %}
                            <td>{{ eventFrameAttributeTemplate.Lookup.LookupValues.filter_by(Value = eventFrameAttributeTemplate.DefaultStartValue).
                                one_or_none().Name }}</td>
                            <td>{{ eventFrameAttributeTemplate.Lookup.LookupValues.filter_by(Value = eventFrameAttributeTemplate.DefaultEndValue).
                                one_or_none().Name }}</td>
                        {% endif %}
                        <td><a class = "btn btn-default" title = "Edit" href = '{{ url_for("eventFrameAttributeTemplates.editEventFrameAttributeTemplate",
                            eventFrameAttributeTemplateId = eventFrameAttributeTemplate.EventFrameAttributeTemplateId) }}'>
                            <span class = "glyphicon glyphicon-edit"></span></a></td>
                        <td><a class = "btn btn-default" title = "Delete" href = '{{ url_for("eventFrameAttributeTemplates.deleteEventFrameAttributeTemplate",
                            eventFrameAttributeTemplateId = eventFrameAttributeTemplate.EventFrameAttributeTemplateId) }}',
                            data-type = "event frame attribute template", data-name = "{{ eventFrameAttributeTemplate.Name }}">
                            <span class = "glyphicon glyphicon-trash"></span></a></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <div class = "page-header">
            <h1>Event Frames <small>Event Frame Template Views</small></h1>
            <a class = "btn btn-default" title = "Add Event Frame Template View"
                href = '{{ url_for("eventFrameTemplateViews.add", eventFrameTemplateId = parent.EventFrameTemplateId) }}' role = "button">
                <span class = "glyphicon glyphicon-plus"></span></a>
            <br><br>
            <div id = "divEventFrameTemplateViewsReorderedFlashedMessages">
            </div>
            <table id = "eventFrameTemplateViewsTable" class = "table table-hover" style = "display:none">
                <thead>
                    <tr>
                        <th>Order</th>
                        <th>EventFrameTemplateViewId</th>
                        <th>Name</th>
                        <th>Description</th>
                        <th>Default</th>
                        <th>Selectable</th>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    {% for eventFrameTemplateView in parent.EventFrameTemplateViews | sort(attribute = "Order")%}
                    <tr data-eventFrameTemplateViewId = "{{ eventFrameTemplateView.EventFrameTemplateViewId }}">
                        <td >{{ loop.index }}</td>
                        <td>{{ eventFrameTemplateView.EventFrameTemplateViewId }}</td>
                        <td>{{ eventFrameTemplateView.Name }}</td>
                        <td>{{ eventFrameTemplateView.Description }}</td>
                        <td>{{ eventFrameTemplateView.Default | yesNo }}</td>
                        <td>{{ eventFrameTemplateView.Selectable | yesNo }}</td>
                        {% if current_user.isAdministrator() %}
                            <td><a class = "btn btn-default" title = "Configure" href = '{{ url_for("eventFrameTemplateViews.eventFrameAttributeTemplates",
                                eventFrameTemplateViewId = eventFrameTemplateView.EventFrameTemplateViewId) }}'><span class = "glyphicon glyphicon-wrench">
                                </span></a></td>
                            <td><a class = "btn btn-default" title = "Copy" href = '{{ url_for("eventFrameTemplateViews.copy",
                                fromEventFrameTemplateViewId = eventFrameTemplateView.EventFrameTemplateViewId) }}'>
                                <span class = "glyphicon glyphicon-copy"></span></a></td>
                            <td><a class = "btn btn-default" title = "Edit" href = '{{ url_for("eventFrameTemplateViews.edit",
                                eventFrameTemplateViewId = eventFrameTemplateView.EventFrameTemplateViewId) }}'>
                                <span class = "glyphicon glyphicon-edit"></span></a></td>
                            <td><a class = "btn btn-default" title = "Delete" href = '{{ url_for("eventFrameTemplateViews.delete",
                                eventFrameTemplateViewId = eventFrameTemplateView.EventFrameTemplateViewId) }}',
                                data-type = "event frame template view", data-name = "{{ eventFrameTemplateView.Name }}">
                                <span class = "glyphicon glyphicon-trash"></span></a></td>
                        {% else %}
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        {% endif %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% endif %}
{% endblock %}

{% block scripts %}
    {{ super() }}
    <link rel = "stylesheet" type = "text/css" href = '{{ url_for("static", filename = "css/datatables.min.css") }}' /> 
    <script type = "text/javascript" src = '{{ url_for("static", filename = "js/datatables.min.js") }}'></script>
    {% block setTabIndex %}
        {{ super() }}
    {% endblock %}
    <script>
        function checkForNotifications()
        {
            $.ajax('{{ url_for("notifications.getNotifications") }}?since=0').done(function(notifications)
            {
                for (var i = 0; i < notifications.length; i++)
                {
                    if (notifications[i].name == "unreadEventFrameMessageCount")
                    {
                        for (var eventFrameId in notifications[i].data)
                        {
                            setEventFrameMessageCount(eventFrameId, notifications[i].data[eventFrameId])
                        }
                    }
                }
            })
        }
    </script>
    <script>  
        $(document).ready(function()
        {
            {% if childrenClass == "EventFrame" %}
                $("#table thead tr").clone(true).appendTo("#table thead")
                $("#table thead tr:eq(1) th").each(function(i)
                {
                    var id = $(this).attr("id")
                    var title = $(this).text()
                    if (title != "" && id != "thStartTimestamp" && id != "thEndTimestamp" && id != "thDuration")
                    {
                        $(this).html('<input type = "text" placeholder = "Filter ' + title + '" />')
                        $("input", this).on("keyup change", function ()
                        {
                            if (table.column(i).search() !== this.value)
                            {
                                table.column(i).search(this.value).draw()
                            }
                        })
                    }
                    else
                    {
                        $(this).html("")
                    }
                })
            {% endif %}

            var table = $("#table").DataTable
            ({
                "order":
                [
                    {% if childrenClass == "Enterprise" or childrenClass == "Site" or childrenClass == "ElementTemplate" %}
                        [2, "asc"]              // Name.
                    {% elif childrenClass == "EventFrameTemplate" %}
                        [2, "asc"]              // Name.
                    {% elif childrenClass == "EventFrame" %}
                        [7, "desc"]             // Start timestamp.
                    {% endif %}
                ],
                "columns":
                [
                    { "orderable": false },     // Select button.
                    { "orderable": false },     // Dash button.
                    {% if childrenClass == "EventFrame" %}
                        { "orderable": false }, // Message button.
                    {% endif %}
                    {% if childrenClass == "Enterprise" or childrenClass == "Site" or childrenClass == "ElementTemplate" %}
                        null,
                        null
                    {% elif childrenClass == "EventFrameTemplate" %}
                        null,
                        null,
                        { "orderable": false }, // Associate button.
                        { "orderable": false }, // Copy button.
                        { "orderable": false }, // Edit button.
                        { "orderable": false }  // Delete button.
                    {% elif childrenClass == "EventFrame" %}
                        null,
                        null,
                        null,
                        null,
                        null,
                        null,
                        null,
                        null,
                        { "orderable": false }, // Associate button.
                        { "orderable": false }, // Stop button.
                        { "orderable": false }, // Edit button.
                        { "orderable": false }, // Delete button.
                        {% for eventFrameAttributeTemplate in eventFrameAttributeTemplates %}
                            null,
                        {% endfor %}
                    {% elif childrenClass == "DescendantEventFrameTemplate" %}
                        null,
                        null,
                        null,
                        { "orderable": false }, // Edit button.
                        { "orderable": false }  // Delete button.
                    {% endif %}
                ],
                "columnDefs":
                [
                    {% if childrenClass == "EventFrame" %}
                        {"orderData": 9, "targets": 10},
                        {"visible": false, "targets": 9},
                        {% for eventFrameAttributeTemplate in eventFrameAttributeTemplates %}
                            {"visible": false, "targets": {{ loop.index0 + namespace.numberOfDefaultColumnsForEventFrames }}},
                        {% endfor %}
                    {% endif %}
                ],
                "stateSave": true,
                "stateDuration": 0,
                "pageLength": 25,
                "orderCellsTop": true,
                "fixedHeader": true
            })

            var eventFrameAttributeTemplatesTable = $('#eventFrameAttributeTemplatesTable').DataTable
            ({
                "order":
                [
                    [0, 'asc']              // Name.
                ],
                "columns":
                [
                    null,
                    null,
                    null,
                    null,
                    null,
                    null,
                    { "orderable": false }, // Edit button.
                    { "orderable": false }  // Delete button.
                ],
                "stateSave": true,
                "stateDuration": 0,
                "pageLength": 25
            })

            var eventFrameTemplateViewsTable = $('#eventFrameTemplateViewsTable').DataTable
            ({

                "pageLength": 25,
                "rowReorder": true,
                "searching": false,
                columnDefs:
                [
                    {orderable: true, className: "reorder", targets: 0},
                    {orderable: false, targets: "_all"},
                    {visible: false, targets: 1}
                ]
            })

            $("#table").attr("style", "width:100%")
            $("#eventFrameAttributeTemplatesTable").attr("style", "width:100%")
            $("#eventFrameTemplateViewsTable").attr("style", "width:100%")
            $("#divLoading").attr("style", "display:none")

            $("a[title='Delete']").on("click", function ()
            {
                var name = $(this).attr("data-name")
                var type = $(this).attr("data-type")
                if(!window.confirm('Are you sure you want to delete the "' + name + '" ' + type + '?'))
                {
                    event.preventDefault()
                }
            })

            $("#buttonHideAllColumns").on("click", function()
            {
                table.columns().every(function ()
                {
                    if (this.index() > {{ namespace.numberOfDefaultColumnsForEventFrames -1 }})
                    {
                        this.visible(false)
                        $(".btn.btn-primary.btn-xs[data-columnIndex = " + this.index() + "]").removeClass("active")
                    }
                })
            })

            $("#buttonShowAllColumns").on("click", function()
            {
                table.columns().every(function ()
                {
                    if (this.index() > {{ namespace.numberOfDefaultColumnsForEventFrames -1 }})
                    {
                        this.visible(true)
                        $(".btn.btn-primary.btn-xs[data-columnIndex = " + this.index() + "]").addClass("active")
                    }
                })
            })

            $("[id^=buttonToggleColumn]").on("click", function(e)
            {
                e.preventDefault();
        
                // Get the column API object
                var column = table.column($(this).attr("data-columnIndex"))
        
                // Toggle the visibility
                column.visible(!column.visible())

                if ($(this).hasClass("active"))
                {
                    $(this).removeClass("active")
                }
                else
                {
                    $(this).addClass("active")
                }
            })

            eventFrameTemplateViewsTable.on("row-reorder", function(e, details, edit)
            {
                var incomingEventFrameTemplateViews = {}
                for(var i = 0, ien = details.length; i < ien; i++)
                {
                    var rowData = eventFrameTemplateViewsTable.row(details[i].node).data();
                    var newOrder = details[i].newData
                    incomingEventFrameTemplateViews[rowData[1]] = newOrder
                }

                $.ajax(
                {
                    type : "POST",
                    url : "/eventFrameTemplateViews/reorder/{{ parent.EventFrameTemplateId }}",
                    data : JSON.stringify(incomingEventFrameTemplateViews)
                }).done(function()
                {
                    $(".alert").remove()
                    $("#divEventFrameTemplateViewsReorderedFlashedMessages").append("<div class = \"alert alert-success\"><button type = \"button\" " +
                        "class = \"close\" data-dismiss = \"alert\">&times;</button>" +
                        "The attempt to reorder one or more event frame template views was successful.</div>")
                }).fail(function()
                {
                    $("#divEventFrameTemplateViewsReorderedFlashedMessages").append("<div class = \"alert alert-danger\"><button type = \"button\" " +
                        "class = \"close\" data-dismiss = \"alert\">&times;</button>" +
                        "The attempt to reorder one or more event frame template views failed.</div>")
                })
            })

            table.columns().every(function ()
            {
                if (this.visible())
                {
                    $(".btn.btn-primary.btn-xs[data-columnIndex = " + this.index() + "]").addClass("active")
                }
                else
                {
                    $(".btn.btn-primary.btn-xs[data-columnIndex = " + this.index() + "]").removeClass("active")
                }
            })

            // Clear any left over filtering from state saving.
            table.search("").columns().search("").draw()
            eventFrameAttributeTemplatesTable.search("").columns().search("").draw()
            eventFrameTemplateViewsTable.search("").columns().search("").draw()
            table.on("draw.dt", function()
            {
                checkForNotifications()
                setTabIndex()
            })
            checkForNotifications()
            setTabIndex()
            $('ol.breadcrumb a[title="Next"]').focus()
        })
    </script>
{% endblock %}
